# üîå ESP32 - IoT Light Control Guide

## üì¶ ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°

### ‡∏Æ‡∏≤‡∏£‡πå‡∏î‡πÅ‡∏ß‡∏£‡πå:
1. **ESP32 Development Board** (‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì 150-300 ‡∏ö‡∏≤‡∏ó)
2. **LED** (‡∏™‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡∏Å‡πá‡πÑ‡∏î‡πâ)
3. **‡∏ï‡∏±‡∏ß‡∏ï‡πâ‡∏≤‡∏ô‡∏ó‡∏≤‡∏ô 220Œ©** (1 ‡∏ï‡∏±‡∏ß)
4. **‡∏™‡∏≤‡∏¢‡∏à‡∏±‡∏°‡πÄ‡∏õ‡∏≠‡∏£‡πå** (2-3 ‡πÄ‡∏™‡πâ‡∏ô)
5. **Breadboard** (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)

### ‡∏ã‡∏≠‡∏ü‡∏ï‡πå‡πÅ‡∏ß‡∏£‡πå:
1. **Arduino IDE** - [‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î](https://www.arduino.cc/en/software)
2. **ESP32 Board Package** - ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏ú‡πà‡∏≤‡∏ô Arduino IDE
3. **ArduinoJson Library** - ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö parse JSON (‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πâ WiFi)

---

## üîß ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà  1: ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á Arduino IDE

1. ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á Arduino IDE
2. ‡πÄ‡∏õ‡∏¥‡∏î Arduino IDE ‚Üí File ‚Üí Preferences
3. ‡πÉ‡∏ô "Additional Board Manager URLs" ‡πÉ‡∏™‡πà:
   ```
   https://raw.githubusercontent.com/espressif/arduino-esp32/gh-pages/package_esp32_index.json
   ```
4. Tools ‚Üí Board ‚Üí Boards Manager ‚Üí ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ "ESP32" ‚Üí Install

---

## ‚ö° ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 2: ‡∏ï‡πà‡∏≠‡∏ß‡∏á‡∏à‡∏£

### ‡πÅ‡∏ö‡∏ö‡∏á‡πà‡∏≤‡∏¢ (‡πÉ‡∏ä‡πâ LED Built-in):
```
‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡πà‡∏≠‡∏≠‡∏∞‡πÑ‡∏£ - ‡πÉ‡∏ä‡πâ LED ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ô ESP32 ‡∏ó‡∏µ‡πà GPIO2
```

### ‡πÅ‡∏ö‡∏ö‡∏ï‡πà‡∏≠ LED ‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å:
```
ESP32 GPIO2 ‚Üí ‡∏ï‡∏±‡∏ß‡∏ï‡πâ‡∏≤‡∏ô‡∏ó‡∏≤‡∏ô 220Œ© ‚Üí LED (+) ‚Üí GND
```

**‡∏ß‡∏á‡∏à‡∏£:**
```
         ESP32
           |
        GPIO2 ----[220Œ©]---- LED+ ---- GND
```

### ‡πÅ‡∏ö‡∏ö‡πÉ‡∏ä‡πâ Relay (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡πÑ‡∏ü‡∏ö‡πâ‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á):
```
ESP32 GPIO2 ‚Üí Relay IN
Relay VCC ‚Üí 5V (ESP32)
Relay GND ‚Üí GND
Relay COM ‚Üí AC Power
Relay NO ‚Üí ‡∏´‡∏•‡∏≠‡∏î‡πÑ‡∏ü
```

‚ö†Ô∏è **‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô**: ‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠‡πÑ‡∏ü AC ‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏∞‡∏ß‡∏±‡∏á‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏£‡πÉ‡∏´‡πâ‡∏ä‡πà‡∏≤‡∏á‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡∏ä‡πà‡∏ß‡∏¢!

---

## üíª ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 3: ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏Ñ‡πâ‡∏î

### ‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà 1: Blink ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ WiFi)

**‡πÑ‡∏ü‡∏•‡πå:** `esp32-simple-blink.ino`

1. ‡πÄ‡∏õ‡∏¥‡∏î Arduino IDE
2. File ‚Üí Open ‚Üí ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å `esp32-simple-blink.ino`
3. Tools ‚Üí Board ‚Üí ESP32 Dev Module
4. Tools ‚Üí Port ‚Üí ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å COM port ‡∏Ç‡∏≠‡∏á ESP32
5. ‡∏Å‡∏î Upload (‡∏•‡∏π‡∏Å‡∏®‡∏£‡∏ä‡∏µ‡πâ‡∏Ç‡∏ß‡∏≤)
6. ‡∏£‡∏≠‡∏à‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à ‚Üí LED ‡∏à‡∏∞‡∏Å‡∏£‡∏∞‡∏û‡∏£‡∏¥‡∏ö‡∏ó‡∏∏‡∏Å 2 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ

**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:**
```
LED ON  (2 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)
LED OFF (2 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)
LED ON  (2 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)
LED OFF (2 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)
...
```

---

### ‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà 2: ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏ú‡πà‡∏≤‡∏ô WiFi + Backend API

**‡πÑ‡∏ü‡∏•‡πå:** `esp32-light-control.ino`

#### ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á Library ‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô:
1. Arduino IDE ‚Üí Tools ‚Üí Manage Libraries
2. ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ "ArduinoJson" ‚Üí Install

#### ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô Code:
```cpp
// WiFi Configuration
const char* ssid = "YOUR_WIFI_NAME";        // ‚Üê ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
const char* password = "YOUR_WIFI_PASSWORD"; // ‚Üê ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ

// Backend API URL
const char* apiUrl = "http://YOUR_BACKEND_URL/api/devices"; // ‚Üê ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
```

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á URL:**
- **Localhost**: `http://192.168.1.100:5000/api/devices`
- **Production**: `http://your-backend-domain.com/api/devices`
- **Ngrok**: `http://abc123.ngrok.io/api/devices`

#### ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î:
1. File ‚Üí Open ‚Üí ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å `esp32-light-control.ino`
2. ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ñ‡πà‡∏≤ WiFi ‡πÅ‡∏•‡∏∞ API URL
3. Tools ‚Üí Board ‚Üí ESP32 Dev Module
4. Tools ‚Üí Port ‚Üí ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å COM port
5. ‡∏Å‡∏î Upload
6. ‡πÄ‡∏õ‡∏¥‡∏î Serial Monitor (Ctrl+Shift+M) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π log

**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÉ‡∏ô Serial Monitor:**
```
[WiFi] Connecting to WiFi...
[WiFi] ‚úÖ Connected!
[WiFi] IP Address: 192.168.1.123

[API] üì° Checking device status...
[API] ‚úÖ Response received
[Device] DeviceId: LIGHT_001
[Device] Status: off
[LED] üí° Turned OFF

(‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ô Dashboard)
[Device] Status: on
[LED] üí° Turned ON
```

---

## üåê ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 4: ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Backend

### ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô:
1. ESP32 ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ WiFi
2. ‡∏ó‡∏∏‡∏Å‡πÜ 2 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ ESP32 ‡∏à‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API `GET /api/devices`
3. Backend ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤
4. ESP32 ‡∏´‡∏≤ `deviceId: "LIGHT_001"` ‡πÅ‡∏•‡∏∞‡∏î‡∏π‡∏ß‡πà‡∏≤ `status` ‡πÄ‡∏õ‡πá‡∏ô `"on"` ‡∏´‡∏£‡∏∑‡∏≠ `"off"`
5. ‡∏ñ‡πâ‡∏≤ `"on"` ‚Üí ‡πÄ‡∏õ‡∏¥‡∏î LED
6. ‡∏ñ‡πâ‡∏≤ `"off"` ‚Üí ‡∏õ‡∏¥‡∏î LED

### ‡∏ó‡∏î‡∏™‡∏≠‡∏ö:
1. ‡πÄ‡∏õ‡∏¥‡∏î Frontend Dashboard ‚Üí http://localhost:3000
2. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤ "Device Control"
3. ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° Toggle ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö "LIGHT_001"
4. ‡∏î‡∏π Serial Monitor ‚Üí LED ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 2 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ

---

## üîç Troubleshooting

### ‡∏õ‡∏±‡∏ç‡∏´‡∏≤: ESP32 ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ WiFi ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ
**‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:**
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏£‡∏´‡∏±‡∏™ WiFi
- ‡πÉ‡∏ä‡πâ WiFi 2.4GHz (ESP32 ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö 5GHz)
- ‡∏•‡∏≠‡∏á Reset ESP32 (‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° BOOT + EN)

### ‡∏õ‡∏±‡∏ç‡∏´‡∏≤: API ‡πÑ‡∏°‡πà‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö
**‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:**
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö URL ‡∏ß‡πà‡∏≤‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
- ‡∏•‡∏≠‡∏á ping URL ‡∏à‡∏≤‡∏Å‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö CORS ‡πÉ‡∏ô Backend (‡∏Ñ‡∏ß‡∏£‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï ESP32 IP)

### ‡∏õ‡∏±‡∏ç‡∏´‡∏≤: LED ‡πÑ‡∏°‡πà‡∏ï‡∏¥‡∏î
**‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:**
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠‡∏ß‡∏á‡∏à‡∏£ (‡∏Ç‡∏±‡πâ‡∏ß +/- ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏´‡∏°)
- ‡∏•‡∏≠‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô GPIO Pin ‡∏≠‡∏∑‡πà‡∏ô (‡πÄ‡∏ä‡πà‡∏ô GPIO4, GPIO5)
- ‡πÉ‡∏ä‡πâ‡∏°‡∏±‡∏•‡∏ï‡∏¥‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏ß‡∏±‡∏î‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≤ GPIO

---

## üìä ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏õ (Advanced)

### 1. ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ã‡πá‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥:
- ‡πÉ‡∏ä‡πâ DHT22 sensor
- ‡∏™‡πà‡∏á‡∏Ñ‡πà‡∏≤‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡πÑ‡∏õ‡∏¢‡∏±‡∏á Backend ‡∏ó‡∏∏‡∏Å‡πÜ 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ

### 2. ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏î‡∏ö‡∏ô ESP32:
- ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° ‚Üí ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á Backend ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
- Backend ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï ‚Üí Dashboard ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏ó‡∏±‡∏ô‡∏ó‡∏µ

### 3. ‡πÉ‡∏ä‡πâ MQTT ‡πÅ‡∏ó‡∏ô HTTP:
- ‡πÉ‡∏ä‡πâ MQTT broker (‡πÄ‡∏ä‡πà‡∏ô HiveMQ)
- Real-time communication (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á polling ‡∏ó‡∏∏‡∏Å 2 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)

### 4. ‡πÄ‡∏û‡∏¥‡πà‡∏° OTA (Over-The-Air Update):
- ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï firmware ‡∏ú‡πà‡∏≤‡∏ô WiFi
- ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏ö‡∏™‡∏≤‡∏¢ USB ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á

---

## üìù Example: ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ã‡πá‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏¢‡∏±‡∏á Backend

```cpp
void sendSensorData(float temperature) {
  HTTPClient http;
  String url = String(apiUrl) + "/sensors";
  
  http.begin(url);
  http.addHeader("Content-Type", "application/json");
  
  String jsonPayload = "{";
  jsonPayload += "\"sensorId\":\"TEMP_001\",";
  jsonPayload += "\"value\":" + String(temperature) + ",";
  jsonPayload += "\"unit\":\"¬∞C\"";
  jsonPayload += "}";
  
  int httpCode = http.POST(jsonPayload);
  http.end();
}
```

---

## üéØ ‡∏™‡∏£‡∏∏‡∏õ

| ‡πÅ‡∏ö‡∏ö | ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å | ‡πÉ‡∏ä‡πâ WiFi | ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏à‡∏≤‡∏Å‡πÑ‡∏´‡∏ô |
|-----|---------|----------|--------------|
| Simple Blink | ‚≠ê | ‚ùå | ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ |
| WiFi Control | ‚≠ê‚≠ê‚≠ê | ‚úÖ | Dashboard |
| MQTT | ‚≠ê‚≠ê‚≠ê‚≠ê | ‚úÖ | Real-time |

**‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å Simple Blink ‡∏Å‡πà‡∏≠‡∏ô** ‚Üí ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÄ‡∏õ‡πá‡∏ô WiFi Control ‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á! üöÄ
